<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>write - nuuko</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸª¶</text></svg>">
    <meta name="description" content="Your cozy space for reflection and journaling">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav" role="navigation">
        <div class="nav-content">
            <a href="index.html" class="nav-logo">
                <img src="assets/character/feather-character.svg" alt="nuuko feather" class="feather" style="width: 24px; height: 24px;">
                <span class="nav-brand">nuuko</span>
            </a>
            
            <div class="nav-links">
                <a href="index.html" class="nav-link">
                    <img src="assets/icons/icon-library.svg" alt="home" class="icon" style="width: 16px; height: 16px;">
                    <span>home</span>
                </a>
                <a href="write.html" class="nav-link active">
                    <img src="assets/icons/icon-journal.svg" alt="write" class="icon" style="width: 16px; height: 16px;">
                    <span>write</span>
                </a>
                <a href="insights.html" class="nav-link">
                    <img src="assets/icons/icon-insights.svg" alt="insights" class="icon" style="width: 16px; height: 16px;">
                    <span>patterns</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container" style="padding-top: 2rem; padding-bottom: 3rem; max-width: 1000px;">
        
        <!-- Header -->
        <header class="text-center mb-2xl fade-in">
            <h1 class="mb-sm" id="pageTitle" style="font-size: 2.5rem;">new entry</h1>
            <p class="text-muted mb-lg" id="currentDate" style="font-size: 1.125rem;">monday, january 27</p>
            <div style="width: 64px; height: 4px; background: linear-gradient(to right, var(--nuuko-green), var(--nuuko-clay)); border-radius: 2px; margin: 0 auto; opacity: 0.6;"></div>
        </header>

        <!-- Prompt Section -->
        <section class="card-minimal paper-texture mb-xl slide-up text-center" style="border-left: 4px solid rgba(107, 143, 113, 0.4); animation-delay: 0.1s; max-width: 600px; margin-left: auto; margin-right: auto;">
            <div class="flex items-center justify-center gap-md">
                <img src="assets/icons/magic-wand-icon.svg" alt="magic prompt" style="width: 20px; height: 20px;">
                <div>
                    <h3 class="mb-sm" style="font-size: 1.125rem;">today's reflection prompt:</h3>
                    <p class="italic text-muted" id="writePagePrompt" style="font-size: 1rem; margin: 0; color: var(--nuuko-stone);">what surprised you today?</p>
                </div>
            </div>
        </section>

        <!-- Large Writing Notebook -->
        <section class="slide-up" style="animation-delay: 0.2s;">
            <div class="card paper-texture writing-notebook" style="position: relative; overflow: hidden; background: rgba(255, 255, 255, 0.95); box-shadow: 0 8px 32px rgba(61, 52, 44, 0.1), 0 3px 12px rgba(61, 52, 44, 0.06); min-height: 600px;">
                <!-- Enhanced notebook lines -->
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.05; pointer-events: none; background-image: repeating-linear-gradient(transparent, transparent 1.8rem, var(--nuuko-stone) 1.8rem, var(--nuuko-stone) calc(1.8rem + 1px));"></div>
                
                <!-- Left margin line with subtle style -->
                <div style="position: absolute; top: 0; bottom: 0; left: 4rem; width: 2px; background: linear-gradient(180deg, rgba(154, 107, 81, 0.2) 0%, rgba(154, 107, 81, 0.1) 100%); pointer-events: none; border-radius: 1px;"></div>
                
                <!-- Top margin -->
                <div style="position: absolute; top: 3rem; left: 4rem; right: 2rem; height: 1px; background: rgba(154, 107, 81, 0.15); pointer-events: none;"></div>
                
                <!-- Three hole punch effect -->
                <div class="notebook-holes" style="position: absolute; top: 80px; left: 20px; width: 12px; height: 12px; background: rgba(61, 52, 44, 0.08); border-radius: 50%; pointer-events: none;"></div>
                <div class="notebook-holes" style="position: absolute; top: 200px; left: 20px; width: 12px; height: 12px; background: rgba(61, 52, 44, 0.08); border-radius: 50%; pointer-events: none;"></div>
                <div class="notebook-holes" style="position: absolute; top: 320px; left: 20px; width: 12px; height: 12px; background: rgba(61, 52, 44, 0.08); border-radius: 50%; pointer-events: none;"></div>
                
                <form id="writingForm" style="position: relative; z-index: 1; height: 100%;">
                    <textarea 
                        id="writingArea"
                        class="writing-area"
                        placeholder="start writing here..."
                        aria-label="Your journal entry"
                        style="
                            padding: 4rem 3rem 3rem 5rem; 
                            min-height: 600px; 
                            font-size: 1.125rem; 
                            line-height: 1.8;
                            border: none;
                            background: transparent;
                            resize: none;
                            width: 100%;
                            font-family: var(--font-sans);
                            color: var(--nuuko-espresso);
                        "
                    ></textarea>
                </form>
            </div>
        </section>

        <!-- Controls Row -->
        <div class="grid write-controls slide-up" style="grid-template-columns: 1fr 1fr 1fr; gap: 2rem; margin-top: 2rem; animation-delay: 0.3s;">
            <!-- Mood -->
            <section class="card-minimal paper-texture">
                <h3 class="mb-lg text-center" style="font-size: 1rem;">how are you feeling?</h3>
                
                <div class="mood-spectrum" id="moodSpectrum">
                    <div class="mood-thumb" id="moodThumb" style="left: 50%;"></div>
                </div>
                
                <div class="mood-labels">
                    <span>anxious</span>
                    <span>grateful</span>
                </div>
                
                <div class="mood-current text-center">
                    <p id="currentMood">thoughtful</p>
                </div>
            </section>

            <!-- Stats -->
            <section class="card-minimal paper-texture text-center">
                <h3 class="mb-lg" style="font-size: 1rem;">your words</h3>
                <div style="display: grid; gap: 1rem;">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--nuuko-clay);" id="wordCount">0</div>
                        <div style="font-size: 0.875rem; color: var(--nuuko-stone);">words</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--nuuko-green);" id="readingTime">1 min</div>
                        <div style="font-size: 0.875rem; color: var(--nuuko-stone);">reading time</div>
                    </div>
                </div>
            </section>

            <!-- Actions -->
            <section class="card-minimal paper-texture">
                <div style="display: flex; flex-direction: column; gap: 1rem; justify-content: center; height: 100%;">
                    <button 
                        id="saveButton" 
                        class="btn btn-primary w-full btn-lg"
                        disabled
                        style="justify-content: center;"
                    >
                        <img src="assets/icons/icon-journal.svg" alt="save" style="width: 16px; height: 16px;">
                        <span id="saveButtonText">save page</span>
                    </button>
                    
                    <a href="index.html" class="btn btn-ghost w-full" style="justify-content: center;">
                        <img src="assets/icons/icon-library.svg" alt="home" style="width: 16px; height: 16px;">
                        <span>back home</span>
                    </a>
                </div>
            </section>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden mt-lg" style="background: rgba(214, 126, 126, 0.1); border: 1px solid rgba(214, 126, 126, 0.3); border-radius: 12px; padding: 1rem; backdrop-filter: blur(8px); max-width: 600px; margin: 2rem auto 0;">
            <p style="color: var(--mood-anxious); font-size: 0.875rem; margin: 0; text-align: center;"></p>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="successModal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(61, 52, 44, 0.8); backdrop-filter: blur(8px); z-index: 1000; align-items: center; justify-content: center; padding: 2rem;">
        <div class="card text-center paper-texture" style="max-width: 400px; width: 100%;">
            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, rgba(107, 143, 113, 0.2) 0%, rgba(154, 107, 81, 0.2) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; backdrop-filter: blur(8px);">
                <img src="assets/icons/streak-icon.svg" alt="success" style="width: 40px; height: 40px;" class="float">
            </div>
            <h2 class="mb-sm">nice start</h2>
            <p class="mb-lg">your words are now part of your collection</p>
            <button id="closeModal" class="btn btn-primary">
                <img src="assets/icons/icon-library.svg" alt="home" style="width: 16px; height: 16px;">
                <span>back home</span>
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Initialize mood and writing functionality
        let currentMoodPosition = 50;
        let wordCount = 0;
        
        // DOM elements
        const writingArea = document.getElementById('writingArea');
        const moodSpectrum = document.getElementById('moodSpectrum');
        const moodThumb = document.getElementById('moodThumb');
        const currentMoodDisplay = document.getElementById('currentMood');
        const wordCountDisplay = document.getElementById('wordCount');
        const readingTimeDisplay = document.getElementById('readingTime');
        const saveButton = document.getElementById('saveButton');
        const saveButtonText = document.getElementById('saveButtonText');
        const errorMessage = document.getElementById('errorMessage');
        const successModal = document.getElementById('successModal');
        const closeModal = document.getElementById('closeModal');
        const currentDateDisplay = document.getElementById('currentDate');
        
        // Set current date
        const today = new Date();
        const dateString = today.toLocaleDateString('en-US', { 
            weekday: 'long', 
            month: 'long', 
            day: 'numeric'
        }).toLowerCase();
        currentDateDisplay.textContent = dateString;
        
        // Load current prompt from localStorage (same as homepage)
        const currentPrompt = localStorage.getItem('nuuko_current_prompt') || 'what surprised you today?';
        const writePagePrompt = document.getElementById('writePagePrompt');
        if (writePagePrompt) {
            writePagePrompt.textContent = currentPrompt;
        }
        
        // Mood mapping
        const moods = ['anxious', 'melancholy', 'calm', 'thoughtful', 'joyful', 'energetic', 'grateful'];
        
        function getMoodFromPosition(position) {
            const index = Math.floor((position / 100) * 7);
            return moods[Math.min(index, 6)];
        }
        
        function updateMoodDisplay() {
            currentMoodDisplay.textContent = getMoodFromPosition(currentMoodPosition);
        }
        
        // Mood spectrum interaction
        moodSpectrum.addEventListener('click', (e) => {
            const rect = moodSpectrum.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));
            
            currentMoodPosition = percentage;
            moodThumb.style.left = percentage + '%';
            updateMoodDisplay();
        });
        
        // Word count and reading time
        function updateStats() {
            const text = writingArea.value.trim();
            const words = text === '' ? 0 : text.split(/\s+/).filter(word => word.length > 0).length;
            
            wordCount = words;
            wordCountDisplay.textContent = wordCount;
            
            const readingMinutes = Math.max(1, Math.ceil(wordCount / 200));
            readingTimeDisplay.textContent = readingMinutes + ' min';
            
            // Enable/disable save button
            saveButton.disabled = wordCount === 0;
            saveButton.style.opacity = wordCount === 0 ? '0.5' : '1';
            saveButton.style.cursor = wordCount === 0 ? 'not-allowed' : 'pointer';
        }
        
        // Auto-resize textarea
        function autoResize() {
            writingArea.style.height = 'auto';
            writingArea.style.height = Math.max(600, writingArea.scrollHeight) + 'px';
        }
        
        // Writing area events
        writingArea.addEventListener('input', () => {
            updateStats();
            autoResize();
            hideError();
        });
        
        writingArea.addEventListener('keydown', autoResize);
        
        // Error handling
        function showError(message) {
            errorMessage.querySelector('p').textContent = message;
            errorMessage.classList.remove('hidden');
        }
        
        function hideError() {
            errorMessage.classList.add('hidden');
        }
        
        // Save functionality
        function saveEntry() {
            const content = writingArea.value.trim();
            
            if (content.length < 10) {
                showError('please write a bit more to save your reflection');
                return;
            }
            
            // Show saving state
            saveButtonText.textContent = 'saving...';
            saveButton.disabled = true;
            
            // Simulate save (in real app, this would save to localStorage/database)
            setTimeout(() => {
                // Store the entry
                const entry = {
                    id: Date.now(),
                    content: content,
                    mood: getMoodFromPosition(currentMoodPosition),
                    wordCount: wordCount,
                    createdAt: new Date().toISOString(),
                    date: dateString
                };
                
                // Save to localStorage
                const entries = JSON.parse(localStorage.getItem('nuuko_entries') || '[]');
                entries.unshift(entry); // Add to beginning
                localStorage.setItem('nuuko_entries', JSON.stringify(entries.slice(0, 50))); // Keep only last 50
                
                // Update stats
                const stats = JSON.parse(localStorage.getItem('nuuko_stats') || '{}');
                stats.totalEntries = (stats.totalEntries || 0) + 1;
                stats.totalWords = (stats.totalWords || 0) + wordCount;
                stats.lastEntryDate = new Date().toISOString();
                localStorage.setItem('nuuko_stats', JSON.stringify(stats));
                
                // Show success
                successModal.classList.remove('hidden');
                successModal.classList.add('modal-visible');
                
                // Reset form
                writingArea.value = '';
                updateStats();
                saveButtonText.textContent = 'save page';
            }, 1000);
        }
        
        saveButton.addEventListener('click', saveEntry);
        
        // Success modal
        closeModal.addEventListener('click', () => {
            successModal.classList.add('hidden');
            successModal.classList.remove('modal-visible');
            window.location.href = 'index.html';
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 's') {
                e.preventDefault();
                if (!saveButton.disabled) {
                    saveEntry();
                }
            }
            
            if (e.key === 'Escape' && !successModal.classList.contains('hidden')) {
                closeModal.click();
            }
        });
        
        // Focus on writing area when page loads
        window.addEventListener('load', () => {
            writingArea.focus();
            updateMoodDisplay();
            
            // Set appropriate page title
            const entries = JSON.parse(localStorage.getItem('nuuko_entries') || '[]');
            const pageTitle = document.getElementById('pageTitle');
            if (entries.length === 0) {
                pageTitle.textContent = 'first entry';
            } else {
                pageTitle.textContent = 'new entry';
            }
        });
        
        // Auto-save draft every 30 seconds
        setInterval(() => {
            const content = writingArea.value.trim();
            if (content.length > 0) {
                localStorage.setItem('nuuko_draft', content);
                localStorage.setItem('nuuko_draft_mood', currentMoodPosition);
            }
        }, 30000);
        
        // Load draft on page load
        window.addEventListener('load', () => {
            const draft = localStorage.getItem('nuuko_draft');
            const draftMood = localStorage.getItem('nuuko_draft_mood');
            
            if (draft && draft.trim().length > 0) {
                writingArea.value = draft;
                updateStats();
                autoResize();
            }
            
            if (draftMood) {
                currentMoodPosition = parseFloat(draftMood);
                moodThumb.style.left = currentMoodPosition + '%';
                updateMoodDisplay();
            }
        });
    </script>
</body>
</html>
