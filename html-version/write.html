<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>write - nuuko</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü™∂</text></svg>">
    <meta name="description" content="Your cozy space for reflection and journaling">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav" role="navigation">
        <div class="nav-content">
            <a href="index.html" class="nav-logo">
                <span class="feather">ü™∂</span>
                <span class="nav-brand">nuuko</span>
            </a>
            
            <div class="nav-links">
                <a href="index.html" class="nav-link">
                    <span class="icon">üè†</span>
                    <span>home</span>
                </a>
                <a href="write.html" class="nav-link active">
                    <span class="icon">ü™∂</span>
                    <span>write</span>
                </a>
                <a href="insights.html" class="nav-link">
                    <span class="icon">‚ú®</span>
                    <span>patterns</span>
                </a>
                <a href="feedback.html" class="nav-link">
                    <span class="icon">üìÆ</span>
                    <span>feedback</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container" style="padding-top: 2rem; padding-bottom: 3rem; max-width: 1000px;">
        
        <!-- Header -->
        <header class="text-center mb-2xl fade-in">
            <h1 class="mb-sm" id="pageTitle" style="font-size: 2.5rem;">new entry</h1>
            <p class="text-muted mb-lg" id="currentDate" style="font-size: 1.125rem;">monday, january 27</p>
            <div style="width: 64px; height: 4px; background: linear-gradient(to right, var(--nuuko-green), var(--nuuko-clay)); border-radius: 2px; margin: 0 auto; opacity: 0.6;"></div>
        </header>

        <!-- Prompt Section -->
        <section id="promptSection" class="card-minimal paper-texture mb-xl slide-up" style="border-left: 4px solid rgba(107, 143, 113, 0.4); animation-delay: 0.1s; max-width: 600px; margin-left: auto; margin-right: auto;">
            <div class="flex flex-col gap-md">
                <div class="flex items-center justify-between gap-md">
                    <div class="flex items-center gap-md">
                        <button type="button" onclick="randomizePrompt()" aria-label="new prompt" style="border: none; width: 44px; height: 44px; border-radius: 50%; background: rgba(107, 143, 113, 0.15); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: inset 0 1px 2px rgba(255,255,255,0.5);">
                            <span style="font-size: 1.2rem;">‚ú®</span>
                        </button>
                        <div>
                            <p style="margin: 0; font-size: 0.75rem; letter-spacing: 0.2em; text-transform: uppercase; color: rgba(61,52,44,0.6);">today's reflection prompt</p>
                            <p class="italic text-muted" id="writePagePrompt" style="font-size: 1rem; margin: 0; color: var(--nuuko-stone); border-bottom: 2px dashed rgba(154, 107, 81, 0.3); display: inline-block;">what surprised you today?</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-xs">
                        <button type="button" aria-label="edit prompt" onclick="startPromptEdit()" style="border: none; width: 32px; height: 32px; border-radius: 50%; background: rgba(154, 107, 81, 0.15); color: var(--nuuko-clay); display: flex; align-items: center; justify-content: center; cursor: pointer;">
                            ‚úèÔ∏è
                        </button>
                        <button type="button" aria-label="hide prompt" onclick="dismissPromptSection()" style="border: none; width: 32px; height: 32px; border-radius: 50%; background: rgba(214, 126, 126, 0.15); color: #c26c6c; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                            ‚úï
                        </button>
                    </div>
                </div>
                <div id="promptEditor" class="hidden" style="margin-top: 0.5rem;">
                    <textarea id="promptEditInput" rows="2" style="width: 100%; padding: 0.75rem 1rem; border-radius: 1rem; border: 1px solid rgba(154, 107, 81, 0.25); font-size: 0.95rem;"></textarea>
                    <div class="flex items-center justify-center gap-sm" style="margin-top: 0.5rem;">
                        <button type="button" class="btn btn-primary text-sm" onclick="savePromptEdit()">save</button>
                        <button type="button" class="btn btn-ghost text-sm" onclick="cancelPromptEdit()">cancel</button>
                    </div>
                </div>
            </div>
        </section>

        <div id="promptHiddenNotice" class="hidden text-center slide-up" style="animation-delay: 0.1s; margin-bottom: 1.5rem;">
            <div class="card-minimal paper-texture" style="padding: 1rem 1.5rem; display: inline-flex; gap: 0.75rem; align-items: center;">
                <span style="color: var(--nuuko-stone); font-size: 0.9rem;">prompt hidden for this entry.</span>
                <button type="button" class="btn btn-ghost text-sm" onclick="restorePromptSection()">show prompt</button>
            </div>
        </div>

        <!-- Large Writing Notebook -->
        <section class="slide-up" style="animation-delay: 0.2s;">
            <div class="card paper-texture writing-notebook" style="position: relative; overflow: hidden; background: rgba(255, 255, 255, 0.95); box-shadow: 0 8px 32px rgba(61, 52, 44, 0.1), 0 3px 12px rgba(61, 52, 44, 0.06); min-height: 600px;">
                <!-- Enhanced notebook lines -->
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.05; pointer-events: none; background-image: repeating-linear-gradient(transparent, transparent 1.8rem, var(--nuuko-stone) 1.8rem, var(--nuuko-stone) calc(1.8rem + 1px));"></div>
                
                <!-- Left margin line with subtle style -->
                <div style="position: absolute; top: 0; bottom: 0; left: 4rem; width: 2px; background: linear-gradient(180deg, rgba(154, 107, 81, 0.2) 0%, rgba(154, 107, 81, 0.1) 100%); pointer-events: none; border-radius: 1px;"></div>
                
                <!-- Top margin -->
                <div style="position: absolute; top: 3rem; left: 4rem; right: 2rem; height: 1px; background: rgba(154, 107, 81, 0.15); pointer-events: none;"></div>
                
                <!-- Three hole punch effect -->
                <div class="notebook-holes" style="position: absolute; top: 80px; left: 20px; width: 12px; height: 12px; background: rgba(61, 52, 44, 0.08); border-radius: 50%; pointer-events: none;"></div>
                <div class="notebook-holes" style="position: absolute; top: 200px; left: 20px; width: 12px; height: 12px; background: rgba(61, 52, 44, 0.08); border-radius: 50%; pointer-events: none;"></div>
                <div class="notebook-holes" style="position: absolute; top: 320px; left: 20px; width: 12px; height: 12px; background: rgba(61, 52, 44, 0.08); border-radius: 50%; pointer-events: none;"></div>
                
                <form id="writingForm" style="position: relative; z-index: 1; height: 100%;">
                    <textarea 
                        id="writingArea"
                        class="writing-area"
                        placeholder="start writing here..."
                        aria-label="Your journal entry"
                        style="
                            padding: 4rem 3rem 3rem 5rem; 
                            min-height: 600px; 
                            font-size: 1.125rem; 
                            line-height: 1.8;
                            border: none;
                            background: transparent;
                            resize: none;
                            width: 100%;
                            font-family: var(--font-sans);
                            color: var(--nuuko-espresso);
                        "
                    ></textarea>
                </form>
            </div>
        </section>

        <!-- Controls Row -->
        <div class="grid write-controls slide-up" style="grid-template-columns: 1fr 1fr 1fr; gap: 2rem; margin-top: 2rem; animation-delay: 0.3s;">
            <!-- Mood -->
            <section class="card-minimal paper-texture">
                <h3 class="mb-lg text-center" style="font-size: 1rem;">how are you feeling?</h3>
                
                <div class="mood-spectrum" id="moodSpectrum">
                    <div class="mood-thumb" id="moodThumb" style="left: 50%;"></div>
                </div>
                
                <div class="mood-labels" style="display: grid; grid-template-columns: repeat(5, 1fr); font-size: 0.8rem; text-transform: lowercase; color: var(--nuuko-stone); margin-top: 0.75rem;">
                    <span style="text-align: left;">anxious</span>
                    <span style="text-align: center;">sad</span>
                    <span style="text-align: center;">neutral</span>
                    <span style="text-align: center;">calm</span>
                    <span style="text-align: right;">happy</span>
                </div>
                
                <div class="mood-current text-center">
                    <p id="currentMood">neutral</p>
                </div>
            </section>

            <!-- Stats -->
            <section class="card-minimal paper-texture text-center">
                <h3 class="mb-lg" style="font-size: 1rem;">your words</h3>
                <div style="display: grid; gap: 1rem;">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--nuuko-clay);" id="wordCount">0</div>
                        <div style="font-size: 0.875rem; color: var(--nuuko-stone);">words</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--nuuko-green);" id="readingTime">1 min</div>
                        <div style="font-size: 0.875rem; color: var(--nuuko-stone);">reading time</div>
                    </div>
                </div>
            </section>

            <!-- Actions -->
            <section class="card-minimal paper-texture">
                <div style="display: flex; flex-direction: column; gap: 1rem; justify-content: center; height: 100%;">
                    <button 
                        id="saveButton" 
                        class="btn btn-primary w-full btn-lg"
                        disabled
                        style="justify-content: center;"
                    >
                        <span>üå±</span>
                        <span id="saveButtonText">save page</span>
                    </button>
                    
                    <a href="index.html" class="btn btn-ghost w-full" style="justify-content: center;">
                        <span>üè†</span>
                        <span>back home</span>
                    </a>
                </div>
            </section>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="hidden mt-lg" style="background: rgba(214, 126, 126, 0.1); border: 1px solid rgba(214, 126, 126, 0.3); border-radius: 12px; padding: 1rem; backdrop-filter: blur(8px); max-width: 600px; margin: 2rem auto 0;">
            <p style="color: var(--mood-anxious); font-size: 0.875rem; margin: 0; text-align: center;"></p>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="successModal" class="hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(61, 52, 44, 0.8); backdrop-filter: blur(8px); z-index: 1000; align-items: center; justify-content: center; padding: 2rem;">
        <div class="card text-center paper-texture" style="max-width: 400px; width: 100%;">
            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, rgba(107, 143, 113, 0.2) 0%, rgba(154, 107, 81, 0.2) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; backdrop-filter: blur(8px);">
                <span style="font-size: 2rem;" class="float">üå±</span>
            </div>
            <h2 class="mb-sm">nice start</h2>
            <p class="mb-lg">your words are now part of your collection ‚ú®</p>
            <button id="closeModal" class="btn btn-primary">
                <span>üè†</span>
                <span>back home</span>
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Initialize mood and writing functionality
        let currentMoodPosition = 50;
        let wordCount = 0;
        
        // DOM elements
        const writingArea = document.getElementById('writingArea');
        const moodSpectrum = document.getElementById('moodSpectrum');
        const moodThumb = document.getElementById('moodThumb');
        const currentMoodDisplay = document.getElementById('currentMood');
        const wordCountDisplay = document.getElementById('wordCount');
        const readingTimeDisplay = document.getElementById('readingTime');
        const saveButton = document.getElementById('saveButton');
        const saveButtonText = document.getElementById('saveButtonText');
        const errorMessage = document.getElementById('errorMessage');
        const successModal = document.getElementById('successModal');
        const closeModal = document.getElementById('closeModal');
        const currentDateDisplay = document.getElementById('currentDate');
        const writePagePrompt = document.getElementById('writePagePrompt');
        const promptEditor = document.getElementById('promptEditor');
        const promptEditInput = document.getElementById('promptEditInput');
        const promptHiddenNotice = document.getElementById('promptHiddenNotice');
        const promptSectionCard = document.getElementById('promptSection');
        
        // Set current date
        const today = new Date();
        const dateString = today.toLocaleDateString('en-US', { 
            weekday: 'long', 
            month: 'long', 
            day: 'numeric'
        }).toLowerCase();
        currentDateDisplay.textContent = dateString;
        
        // Mood mapping
        const moods = ['anxious', 'sad', 'neutral', 'calm', 'happy'];
        
        function getMoodFromPosition(position) {
            const index = Math.floor((position / 100) * 7);
            return moods[Math.min(index, 6)];
        }
        
        function updateMoodDisplay() {
            currentMoodDisplay.textContent = getMoodFromPosition(currentMoodPosition);
        }
        
        // Mood spectrum interaction
        moodSpectrum.addEventListener('click', (e) => {
            const rect = moodSpectrum.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));
            
            currentMoodPosition = percentage;
            moodThumb.style.left = percentage + '%';
            updateMoodDisplay();
        });
        
        // Word count and reading time
        function updateStats() {
            const text = writingArea.value.trim();
            const words = text === '' ? 0 : text.split(/\s+/).filter(word => word.length > 0).length;
            
            wordCount = words;
            wordCountDisplay.textContent = wordCount;
            
            const readingMinutes = Math.max(1, Math.ceil(wordCount / 200));
            readingTimeDisplay.textContent = readingMinutes + ' min';
            
            // Enable/disable save button
            saveButton.disabled = wordCount === 0;
            saveButton.style.opacity = wordCount === 0 ? '0.5' : '1';
            saveButton.style.cursor = wordCount === 0 ? 'not-allowed' : 'pointer';
        }
        
        // Auto-resize textarea
        function autoResize() {
            writingArea.style.height = 'auto';
            writingArea.style.height = Math.max(600, writingArea.scrollHeight) + 'px';
        }
        
        // Writing area events
        writingArea.addEventListener('input', () => {
            updateStats();
            autoResize();
            hideError();
        });
        
        writingArea.addEventListener('keydown', autoResize);
        
        // Error handling
        function showError(message) {
            errorMessage.querySelector('p').textContent = message;
            errorMessage.classList.remove('hidden');
        }
        
        function hideError() {
            errorMessage.classList.add('hidden');
        }
        
        // Save functionality
        function saveEntry() {
            const content = writingArea.value.trim();
            
            if (content.length < 10) {
                showError('please write a bit more to save your reflection');
                return;
            }
            
            // Show saving state
            saveButtonText.textContent = 'saving...';
            saveButton.disabled = true;
            
            // Simulate save (in real app, this would save to localStorage/database)
            setTimeout(() => {
                // Store the entry
                const entry = {
                    id: Date.now(),
                    content: content,
                    mood: getMoodFromPosition(currentMoodPosition),
                    wordCount: wordCount,
                    createdAt: new Date().toISOString(),
                    date: dateString
                };
                
                // Save to localStorage
                const entries = JSON.parse(localStorage.getItem('nuuko_entries') || '[]');
                entries.unshift(entry); // Add to beginning
                localStorage.setItem('nuuko_entries', JSON.stringify(entries.slice(0, 50))); // Keep only last 50
                
                // Update stats
                const stats = JSON.parse(localStorage.getItem('nuuko_stats') || '{}');
                stats.totalEntries = (stats.totalEntries || 0) + 1;
                stats.totalWords = (stats.totalWords || 0) + wordCount;
                stats.lastEntryDate = new Date().toISOString();
                localStorage.setItem('nuuko_stats', JSON.stringify(stats));
                
                // Show success
                successModal.classList.remove('hidden');
                successModal.classList.add('modal-visible');
                
                // Reset form
                writingArea.value = '';
                updateStats();
                saveButtonText.textContent = 'save page';
            }, 1000);
        }
        
        saveButton.addEventListener('click', saveEntry);
        
        // Success modal
        closeModal.addEventListener('click', () => {
            successModal.classList.add('hidden');
            successModal.classList.remove('modal-visible');
            window.location.href = 'index.html';
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.metaKey || e.ctrlKey) && e.key === 's') {
                e.preventDefault();
                if (!saveButton.disabled) {
                    saveEntry();
                }
            }
            
            if (e.key === 'Escape' && !successModal.classList.contains('hidden')) {
                closeModal.click();
            }
        });
        
        // Focus on writing area when page loads
        window.addEventListener('load', () => {
            writingArea.focus();
            updateMoodDisplay();
            
            // Set appropriate page title
            const entries = JSON.parse(localStorage.getItem('nuuko_entries') || '[]');
            const pageTitle = document.getElementById('pageTitle');
            if (entries.length === 0) {
                pageTitle.textContent = 'first entry';
            } else {
                pageTitle.textContent = 'new entry';
            }
        });
        
        // Auto-save draft every 30 seconds
        setInterval(() => {
            const content = writingArea.value.trim();
            if (content.length > 0) {
                localStorage.setItem('nuuko_draft', content);
                localStorage.setItem('nuuko_draft_mood', currentMoodPosition);
            }
        }, 30000);
        
        // Load draft on page load
        window.addEventListener('load', () => {
            const draft = localStorage.getItem('nuuko_draft');
            const draftMood = localStorage.getItem('nuuko_draft_mood');
            
            if (draft && draft.trim().length > 0) {
                writingArea.value = draft;
                updateStats();
                autoResize();
            }
            
            if (draftMood) {
                currentMoodPosition = parseFloat(draftMood);
                moodThumb.style.left = currentMoodPosition + '%';
                updateMoodDisplay();
            }
        });

        // === PROMPT CONTROLS ===
        const SIMPLE_PROMPTS = [
            "what surprised you today?",
            "what made you smile recently?",
            "what are you grateful for right now?",
            "what challenged you today?",
            "what did you learn about yourself?",
            "what moment do you want to remember?",
            "what felt meaningful today?",
            "what are you curious about?",
            "what would you tell your younger self?",
            "what made you feel proud?",
            "what helped you feel calm?",
            "what connection did you make today?",
            "what inspired you recently?",
            "what would you like to let go of?",
            "what are you excited about?",
            "what small joy brightened your day?",
            "what act of kindness touched you?",
            "what made you feel hopeful?",
            "what would you do if you weren't afraid?",
            "what brings you peace?"
        ];

        function getCurrentPromptText() {
            return localStorage.getItem('nuuko_current_prompt') || SIMPLE_PROMPTS[0];
        }

        function applyPromptText(text) {
            const promptElement = document.getElementById('writePagePrompt');
            if (promptElement) {
                promptElement.textContent = text;
            }
            const editorInput = document.getElementById('promptEditInput');
            if (editorInput && document.activeElement !== editorInput) {
                editorInput.value = text;
            }
            localStorage.setItem('nuuko_current_prompt', text);
        }

        function startPromptEdit() {
            const editor = document.getElementById('promptEditor');
            const input = document.getElementById('promptEditInput');
            if (!editor || !input) return;
            input.value = getCurrentPromptText();
            editor.classList.remove('hidden');
            setTimeout(() => input.focus(), 50);
        }

        function cancelPromptEdit(reset = true) {
            const editor = document.getElementById('promptEditor');
            const input = document.getElementById('promptEditInput');
            if (!editor || !input) return;
            editor.classList.add('hidden');
            if (reset) {
                input.value = getCurrentPromptText();
            }
        }

        function savePromptEdit() {
            const input = document.getElementById('promptEditInput');
            if (!input) return;
            const text = input.value.trim();
            if (!text) {
                alert('Write a prompt or cancel editing.');
                return;
            }
            applyPromptText(text);
            cancelPromptEdit(false);
        }

        function randomizePrompt() {
            const current = getCurrentPromptText();
            let next = current;
            if (SIMPLE_PROMPTS.length > 1) {
                do {
                    next = SIMPLE_PROMPTS[Math.floor(Math.random() * SIMPLE_PROMPTS.length)];
                } while (next === current);
            }
            applyPromptText(next);
            cancelPromptEdit(false);
        }

        function togglePromptSection(show) {
            const section = document.getElementById('promptSection');
            const notice = document.getElementById('promptHiddenNotice');
            if (!section || !notice) return;
            if (show) {
                section.classList.remove('hidden');
                notice.classList.add('hidden');
            } else {
                section.classList.add('hidden');
                notice.classList.remove('hidden');
            }
        }

        function dismissPromptSection() {
            togglePromptSection(false);
        }

        function restorePromptSection() {
            togglePromptSection(true);
        }

        function openPromptEditor() {
            if (!promptEditor || !promptEditInput) return;
            promptEditInput.value = writePagePrompt?.textContent?.trim() || '';
            promptEditor.classList.remove('hidden');
            setTimeout(() => promptEditInput.focus(), 30);
        }

        function closePromptEditor(reset = true) {
            if (!promptEditor || !promptEditInput) return;
            if (reset) {
                promptEditInput.value = writePagePrompt?.textContent || '';
            }
            promptEditor.classList.add('hidden');
        }

        function saveEditedPrompt() {
            if (!promptEditInput) return;
            const next = promptEditInput.value.trim();
            if (!next) {
                alert('Write a prompt or cancel editing.');
                promptEditInput.focus();
                return;
            }
            applyPromptText(next);
        }

        function hidePromptCard() {
            if (!promptSectionCard || !promptHiddenNotice) return;
            promptSectionCard.classList.add('hidden');
            promptHiddenNotice.classList.remove('hidden');
        }

        function showPromptCard() {
            if (!promptSectionCard || !promptHiddenNotice) return;
            promptSectionCard.classList.remove('hidden');
            promptHiddenNotice.classList.add('hidden');
        }

        window.addEventListener('load', () => {
            applyPromptText(getCurrentPromptText());
        });

        window.startPromptEdit = openPromptEditor;
        window.cancelPromptEdit = () => closePromptEditor(true);
        window.savePromptEdit = saveEditedPrompt;
        window.randomizePrompt = randomizePrompt;
        window.dismissPromptSection = hidePromptCard;
        window.restorePromptSection = showPromptCard;
    </script>
</body>
</html>
